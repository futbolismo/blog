<script>
  window.addEventListener("load", function(event) {
    var postSize = document.querySelector('.post .post-body').getBoundingClientRect();
    var getMax = function(){
        return (postSize.top + postSize.height) - (window.innerHeight + 300);
        // return document.querySelector('body').getBoundingClientRect().height - window.innerHeight;
        // return $(document).height() - $(window).height();
    }

    var getValue = function(){
        return (window.pageYOffset || document.documentElement.scrollTop) - 300;
    }

    if('max' in document.createElement('progress')){
        // Browser supports progress element
        var progressBar = document.querySelector('progress');

        // Set the Max attr for the first time
        progressBar.setAttribute('max', getMax());

        window.addEventListener("scroll", function(e) {
            // On scroll only Value attr needs to be calculated
            progressBar.setAttribute('value',getValue());
        });

        window.addEventListener("resize", function(e) {
            // On resize, both Max/Value attr needs to be calculated
            postSize = document.querySelector('.post .post-body').getBoundingClientRect();
            progressBar.setAttribute('max', getMax());
            progressBar.setAttribute('value',getValue());
        });
    } else {
        var progressBar = document.querySelector('.progress-bar'),
            max = getMax(),
            value, width;

        var getWidth = function(){
            // Calculate width in percentage
            value = getValue();
            width = (value/max) * 100;
            width = width + '%';
            return width;
        }

        var setWidth = function(){
            progressBar.style.width = getWidth();
        }

        window.addEventListener("scroll", setWidth)
        window.addEventListener("resize", function(e) {
            postSize = document.querySelector('.post .post-body').getBoundingClientRect();
            // Need to reset the Max attr
            max = getMax();
            setWidth();
        });
    }
  });
</script>
